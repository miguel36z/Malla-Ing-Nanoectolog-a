<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Malla Curricular - Ingeniería en Nanotecnología</title>
  <style>
    :root{
      --bg: #f5f8fb;
      --card:#ffffff;
      --muted:#8a98a6;
      --accent:#6aa6d6;
      --success:#8be5a6;
      --danger:#ffd59a;
      --shadow: rgba(18,38,63,0.08);
      --radius:12px;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#123;padding:28px}
    h1{text-align:center;margin:6px 0 20px;font-weight:700}

    .controls{display:flex;gap:10px;justify-content:center;margin-bottom:14px}
    .btn{background:var(--card);border:1px solid #e6eef6;padding:8px 12px;border-radius:8px;cursor:pointer;box-shadow:0 2px 6px var(--shadow)}
    .btn.danger{background:linear-gradient(180deg,#fffbf2,#fff3e0);border-color:#ffd59a}

    .grid-wrapper{overflow:auto;padding:6px;border-radius:10px}
    .grid{display:grid;grid-auto-flow:column;grid-auto-columns:minmax(220px,1fr);gap:18px;padding:12px}

    .semester{background:var(--card);min-width:220px;border-radius:var(--radius);padding:12px 14px;box-shadow:0 6px 18px var(--shadow)}
    .semester h2{margin:0 0 8px;font-size:14px;color:#0f3a57}

    .subject{background:#f7fbff;border-radius:8px;padding:10px 10px;margin:8px 0;cursor:pointer;border-left:5px solid var(--accent);position:relative;transition:transform .08s,box-shadow .08s}
    .subject:hover{transform:translateY(-3px);box-shadow:0 6px 14px rgba(10,30,50,0.06)}
    .subject.approved{background:var(--success);text-decoration:line-through;border-left-color:#3aa86f}
    .subject.locked{background:var(--danger);cursor:not-allowed;border-left-color:#e09b3a}

    /* tooltip element inside subject */
    .tooltip{display:none;position:absolute;left:12px;top:calc(100% + 8px);background:#0b2233;color:#fff;padding:8px;border-radius:8px;font-size:12px;white-space:pre-line;z-index:30;box-shadow:0 6px 18px rgba(2,18,28,0.25)}
    .subject.locked:hover .tooltip{display:block}

    /* responsive: show two rows on wide screens if many semesters */
    @media(min-width:1200px){
      .grid{grid-auto-flow:row;grid-template-columns:repeat(5,minmax(220px,1fr));grid-auto-rows:auto}
    }

    /* small screens */
    @media(max-width:640px){
      .grid{grid-auto-columns:minmax(180px,1fr);gap:12px}
      .semester{min-width:180px}
    }

    .legend{display:flex;gap:10px;justify-content:center;margin-top:10px;font-size:13px;color:var(--muted)}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:6px 8px;border-radius:999px;background:#fff;border:1px solid #e9f2fb}
    .chip .dot{width:12px;height:12px;border-radius:6px}
  </style>
</head>
<body>
  <h1>Malla Curricular — Ingeniería en Nanotecnología</h1>
  <div class="controls">
    <button class="btn" id="exportBtn" title="Exportar progreso como JSON">Exportar</button>
    <button class="btn" id="importBtn" title="Importar progreso (pegar JSON)">Importar</button>
    <button class="btn danger" id="resetBtn">Reiniciar progreso</button>
  </div>

  <div class="grid-wrapper">
    <div class="grid" id="malla"></div>
  </div>

  <div class="legend">
    <div class="chip"><span class="dot" style="background:var(--accent)"></span> Por cursar</div>
    <div class="chip"><span class="dot" style="background:var(--success)"></span> Aprobada</div>
    <div class="chip"><span class="dot" style="background:var(--danger)"></span> Bloqueada (faltan requisitos)</div>
  </div>

  <script>
    // Malla de la carrera — usar nombres exactos para requisitos
    const malla = {
      "PRIMER SEMESTRE": [
        "Cálculo diferencial",
        "Geometría Analítica",
        "Fundamentos de la Química",
        "Introducción a la Nanotecnología",
        "Sistemas Bioinspirados",
        "Optativa CBD"
      ],

      "SEGUNDO SEMESTRE": [
        { name: "Algebra lineal", req: ["Geometría Analítica"] },
        { name: "Química inorgánica", req: ["Fundamentos de la Química"] },
        { name: "Calculo Integral", req: ["Cálculo diferencial"] },
        { name: "Fisica mecánica", req: ["Cálculo diferencial","Geometría Analítica"] },
        { name: "Materiales de Ingeniería", req: ["Fundamentos de la Química"] },
        "Electiva I"
      ],

      "TERCER SEMESTRE": [
        "Humanismo, Cultura y Valores",
        { name: "Ecuaciones Diferenciales", req: ["Calculo Integral"] },
        { name: "Electricidad y Magnetismo", req: ["Fisica mecánica"] },
        { name: "Métodos Experimentales", req: ["Fisica mecánica"] },
        { name: "Técnicas de Caracterización de Materiales", req: ["Materiales de Ingeniería"] },
        "Química Orgánica",
        "Metodología de la investigación"
      ],

      "CUARTO SEMESTRE": [
        "Cristología",
        "Lengua y Cultura",
        { name: "Calculo Vectorial", req: ["Calculo Integral"] },
        { name: "Física Moderna", req: ["Electricidad y Magnetismo","Ecuaciones Diferenciales"] },
        { name: "Nanotecnología I", req: ["Materiales de Ingeniería"] },
        { name: "Fisicoquímica", req: ["Fundamentos de la Química","Calculo Integral"] }
      ],

      "QUINTO SEMESTRE": [
        { name: "Métodos Numéricos", req: ["Ecuaciones Diferenciales"] },
        { name: "Programación", req: ["Calculo Vectorial","Ecuaciones Diferenciales"] },
        { name: "Termodinámica", req: ["Fisicoquímica","Ecuaciones Diferenciales"] },
        { name: "Fenómenos de Transporte", req: ["Ecuaciones Diferenciales","Calculo Vectorial"] },
        { name: "Nanotecnología II", req: ["Nanotecnología I","Técnicas de Caracterización de Materiales"] },
        { name: "Técnicas de Caracterización de Nanomateriales", req: ["Técnicas de Caracterización de Materiales"] }
      ],

      "SEXTO SEMESTRE": [
        "Estadística y Diseño de Experimentos",
        { name: "Nanociencia", req: ["Física Moderna"] },
        { name: "Reología y Nano fluidos", req: ["Fenómenos de Transporte"] },
        { name: "Nanotecnología III", req: ["Nanotecnología II"] },
        { name: "Coloides y Química de Superficies", req: ["Termodinámica"] },
        "Electiva II"
      ],

      "SEPTIMO SEMESTRE": [
        "Línea de Formación I",
        "Emprendimiento y Responsabilidad Social",
        "Economía",
        { name: "Núcleo de Integración I", req: ["Nanotecnología II","Técnicas de Caracterización de Nanomateriales","Nanociencia"] },
        { name: "Bionanotecnología", req: ["Sistemas Bioinspirados","Nanotecnología I","Química Orgánica"] },
        "Basic Writing Skills"
      ],

      "OCTAVO SEMESTRE": [
        "Línea de Formación II",
        "Ética General",
        { name: "Economía Internacional", req: ["Economía"] },
        { name: "Núcleo de Integración II", req: ["Núcleo de Integración I"] },
        "Gestión de proyectos",
        "Optativa CI 2"
      ],

      "NOVENO SEMESTRE": [
        "Línea de Formación III",
        { name: "Ética Profesional", req: ["Ética General"] },
        { name: "Gestión e Innovación en Nanotecnología", req: ["Economía Internacional","Nanotecnología III"] },
        { name: "Núcleo de Integración III", req: ["Núcleo de Integración II"] },
        { name: "Contexto profesional", req: ["Núcleo de Integración II"] },
        "Optativa CI 3"
      ],

      "DECIMO SEMESTRE": [
        { name: "Práctica Profesional", req: Object.keys({}).concat([]) } // placeholder — will be replaced below to require all previous subjects
      ]
    };

    // Build list of all course names to set Práctica Profesional requirements
    (function setPracticaReqs(){
      const todas = [];
      for(const sem of Object.values(malla)){
        for(const item of sem){
          const name = (typeof item === 'string')? item : item.name;
          // skip placeholder practice itself
          if(name === 'Práctica Profesional') continue;
          todas.push(name);
        }
      }
      // set reqs array for práctica
      malla['DECIMO SEMESTRE'][0].req = todas;
    })();

    // Load aprobadas from localStorage
    const STORAGE_KEY = 'nano_aprobadas_v1';
    let aprobadas = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    // Render
    const container = document.getElementById('malla');

    function isReqSatisfied(req){
      return aprobadas.includes(req);
    }

    function render(){
      container.innerHTML = '';
      for(const [sem, materias] of Object.entries(malla)){
        const semDiv = document.createElement('div');
        semDiv.className = 'semester';
        const h = document.createElement('h2'); h.textContent = sem; semDiv.appendChild(h);

        materias.forEach(raw =>{
          const name = (typeof raw === 'string')? raw : raw.name;
          const reqs = raw.req || [];

          const item = document.createElement('div');
          item.className = 'subject';
          item.textContent = name;

          // compute if locked
          const missing = reqs.filter(r => !isReqSatisfied(r));
          const locked = (reqs.length>0) && missing.length>0;

          if(aprobadas.includes(name)) item.classList.add('approved');
          else if(locked) item.classList.add('locked');

          // tooltip for locked showing missing
          if(locked){
            const tip = document.createElement('div');
            tip.className = 'tooltip';
            tip.textContent = 'Faltan requisitos:\n' + missing.join('\n');
            item.appendChild(tip);
          }

          // click toggles approved if not locked
          item.addEventListener('click', ()=>{
            if(locked) return; // do nothing
            const idx = aprobadas.indexOf(name);
            if(idx>=0) aprobadas.splice(idx,1);
            else aprobadas.push(name);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(aprobadas));
            render();
          });

          semDiv.appendChild(item);
        });

        container.appendChild(semDiv);
      }
    }

    // Controls: reset, export, import
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(!confirm('¿Reiniciar todo el progreso?')) return;
      aprobadas = [];
      localStorage.removeItem(STORAGE_KEY);
      render();
    });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const data = JSON.stringify({aprobadas, timestamp: Date.now()}, null, 2);
      // download as file
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'nano_progreso.json'; a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('importBtn').addEventListener('click', ()=>{
      const txt = prompt('Pega aquí el JSON exportado del progreso:');
      if(!txt) return;
      try{
        const parsed = JSON.parse(txt);
        if(Array.isArray(parsed.aprobadas)){
          aprobadas = parsed.aprobadas;
          localStorage.setItem(STORAGE_KEY, JSON.stringify(aprobadas));
          render();
          alert('Progreso importado correctamente.');
        }else alert('JSON inválido: campo aprobadas no encontrado.');
      }catch(e){alert('JSON inválido')}
    });

    // initial render
    render();
  </script>
</body>
</html>
